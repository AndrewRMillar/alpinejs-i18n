{"version":3,"file":"index.module.js","sources":["../src/index.ts"],"sourcesContent":["const AlpineI18n = {\n\tversion: '0.0.0',\n\t/**\n\t * setter for the current locale\n\t */\n\tset locale(name) {\n\t\t//this.checkLocale(name)\n\t\tthis.currentLocale = name;\n\t\tthis.dispatchEvent();\n\t},\n\n\t/**\n\t * getter for the current locale\n\t */\n\tget locale() {\n\t\treturn this.currentLocale;\n\t},\n\n\tcurrentLocale: '',\n\n\t/**\n\t * translations data\n\t * the first keys are the locale codes.\n\t */\n\tmessages: <any>{},\n\n\t/**\n\t * event that will be dispatched when the locale changes\n\t * in order to update alpine components\n\t */\n\tlocalChange: new Event('locale-change'),\n\n\tstart() {\n\t\t// this will add a listener for the locale-change to all components.\n\t\twindow.Alpine.onComponentInitialized((component: any) => {\n\t\t\tcomponent.$el.addEventListener('locale-change', () => {\n\t\t\t\tcomponent.$el.__x.updateElements(component.$el);\n\t\t\t});\n\t\t});\n\n\t\t/**\n\t\t * magic helper $locale\n\t\t * 1) set the locale: $locale('code')\n\t\t * 2) get the locale $locale()\n\t\t **/\n\t\twindow.Alpine.addMagicProperty('locale', () => {\n\t\t\treturn (locale: string | undefined) => {\n\t\t\t\tif (!locale) return this.locale;\n\t\t\t\tthis.checkLocale(locale);\n\t\t\t\tthis.locale = locale;\n\t\t\t};\n\t\t});\n\n\t\t/**\n\t\t * magic helper $t\n\t\t * $t('key')\n\t\t * $t('key', {var: val})\n\t\t */\n\t\twindow.Alpine.addMagicProperty('t', ($el: any) => {\n\t\t\treturn (name: string, vars: object) => {\n\t\t\t\tlet message: string = name\n\t\t\t\t\t.split('.')\n\t\t\t\t\t.reduce((o, i) => o[i], this.messages[this.locale]);\n\t\t\t\tfor (const key in vars) {\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(vars, key)) {\n\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\tconst val: string = vars[key];\n\t\t\t\t\t\tlet regexp = new RegExp('\\{\\s*('+key+')\\s*\\}', '\\g')\t\t\t\t\t\t\n\t\t\t\t\t\tmessage = message.replaceAll(regexp, val);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn message;\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Set up i18n's default locale and data.\n\t * @param locale the default locale\n\t * @param messages the translation data\n\t */\n\tcreate(locale: string, messages: object) {\n\t\tthis.locale = locale;\n\t\tthis.messages = messages;\n\t},\n\n\tdispatchEvent() {\n\t\tdocument.querySelectorAll('[x-data]').forEach((el) => {\n\t\t\tel.dispatchEvent(this.localChange);\n\t\t});\n\t},\n\n\t/**\n\t * Check if a locale exists in the message list\n\t * If it don't throw an Error. Does nothing otherwise.\n\t * @param locale locale to check\n\t */\n\tcheckLocale(locale: string) {\n\t\tif (!Object.keys(this.messages).includes(locale)) {\n\t\t\tthrow new Error(\n\t\t\t\t`Alpine I18n: The locale ${locale} does not exist.`,\n\t\t\t);\n\t\t}\n\t},\n};\n\nconst alpine =\n\twindow.deferLoadingAlpine || ((callback: Function) => callback());\n\nwindow.AlpineI18n = AlpineI18n;\n\nwindow.deferLoadingAlpine = function (callback: Function) {\n\twindow.AlpineI18n.start();\n\talpine(callback);\n};\n\ndeclare global {\n\tinterface Window {\n\t\tAlpine: any;\n\t\tdeferLoadingAlpine: any;\n\t\tAlpineI18n: typeof AlpineI18n;\n\t}\n}\n\nexport default AlpineI18n;\n"],"names":["AlpineI18n","version","locale","name","this","currentLocale","dispatchEvent","messages","localChange","Event","start","window","Alpine","onComponentInitialized","component","$el","addEventListener","__x","updateElements","addMagicProperty","_this","checkLocale","vars","message","split","reduce","o","i","key","Object","prototype","hasOwnProperty","call","val","regexp","RegExp","replaceAll","create","document","querySelectorAll","forEach","el","_this2","keys","includes","Error","alpine","deferLoadingAlpine","callback"],"mappings":"AAAA,IAAMA,EAAa,CAClBC,QAAS,QAITC,WAAWC,GAEVC,KAAKC,cAAgBF,EACrBC,KAAKE,iBAMNJ,aACC,YAAYG,eAGbA,cAAe,GAMfE,SAAe,GAMfC,YAAa,IAAIC,MAAM,iBAEvBC,4BAECC,OAAOC,OAAOC,uBAAuB,SAACC,GACrCA,EAAUC,IAAIC,iBAAiB,gBAAiB,WAC/CF,EAAUC,IAAIE,IAAIC,eAAeJ,EAAUC,SAS7CJ,OAAOC,OAAOO,iBAAiB,SAAU,WACxC,gBAAQjB,GACP,IAAKA,EAAQ,OAAOkB,EAAKlB,OACzBkB,EAAKC,YAAYnB,GACjBkB,EAAKlB,OAASA,KAShBS,OAAOC,OAAOO,iBAAiB,IAAK,SAACJ,GACpC,gBAAQZ,EAAcmB,GACrB,IAAIC,EAAkBpB,EACpBqB,MAAM,KACNC,OAAO,SAACC,EAAGC,UAAMD,EAAEC,IAAIP,EAAKb,SAASa,EAAKlB,SAC5C,IAAK,IAAM0B,KAAON,EACjB,GAAIO,OAAOC,UAAUC,eAAeC,KAAKV,EAAMM,GAAM,CAEpD,IAAMK,EAAcX,EAAKM,GACrBM,EAAS,IAAIC,OAAO,OAASP,EAAI,OAAU,KAC/CL,EAAUA,EAAQa,WAAWF,EAAQD,GAGvC,OAAOV,MAUVc,gBAAOnC,EAAgBK,GACtBH,KAAKF,OAASA,EACdE,KAAKG,SAAWA,GAGjBD,oCACCgC,SAASC,iBAAiB,YAAYC,QAAQ,SAACC,GAC9CA,EAAGnC,cAAcoC,EAAKlC,gBASxBa,qBAAYnB,GACX,IAAK2B,OAAOc,KAAKvC,KAAKG,UAAUqC,SAAS1C,GACxC,UAAU2C,iCACkB3C,wBAMzB4C,EACLnC,OAAOoC,oBAAuB,SAACC,UAAuBA,KAEvDrC,OAAOX,WAAaA,EAEpBW,OAAOoC,mBAAqB,SAAUC,GACrCrC,OAAOX,WAAWU,QAClBoC,EAAOE"}