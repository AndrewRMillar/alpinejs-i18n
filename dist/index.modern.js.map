{"version":3,"file":"index.modern.js","sources":["../src/index.ts"],"sourcesContent":["import type { Alpine } from '@leanadmin/alpine-typescript';\n\nconst AlpineI18n = {\n\tversion: '0.0.3',\n\n\t/**\n\t * setter for the current locale\n\t */\n\tset locale(name) {\n\t\t//this.checkLocale(name)\n\t\tthis.currentLocale = name;\n\t\twindow.dispatchEvent(this.localChange);\n\t\tthis.updateSubscribers();\n\t},\n\n\t/**\n\t * getter for the current locale\n\t */\n\tget locale() {\n\t\treturn this.currentLocale;\n\t},\n\n\tcurrentLocale: '',\n\n\t/**\n\t * translations data\n\t * the first keys are the locale codes.\n\t */\n\tmessages: <any>{},\n\n\t/**\n\t * components that use the magic helpers\n\t */\n\tsubscribers: [],\n\n\t/**\n\t * event that will be dispatched when the locale changes\n\t * useful for when using outside of alpine components\n\t * like changing \"dir\" inside the body\n\t */\n\tlocalChange: new Event('locale-change'),\n\n\tstart() {\n\t\t/**\n\t\t * magic helper $locale\n\t\t * 1) set the locale: $locale('code')\n\t\t * 2) get the locale $locale()\n\t\t **/\n\t\twindow.Alpine.addMagicProperty('locale', ($el: HTMLElement) => {\n\t\t\tthis.subscribe($el);\n\t\t\treturn (locale: string | undefined) => {\n\t\t\t\tif (!locale) return this.locale;\n\t\t\t\tthis.checkLocale(locale);\n\t\t\t\tthis.locale = locale;\n\t\t\t};\n\t\t});\n\n\t\t/**\n\t\t * magic helper $t\n\t\t * $t('key')\n\t\t * $t('key', {var: val})\n\t\t */\n\t\twindow.Alpine.addMagicProperty('t', ($el: HTMLElement) => {\n\t\t\tthis.subscribe($el);\n\t\t\treturn (name: string, vars?: { [name: string]: any }) => {\n\t\t\t\treturn this.t(name, vars);\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Set up i18n's default locale and data.\n\t * @param locale the default locale\n\t * @param messages the translation data\n\t */\n\tcreate(locale: string, messages: { [name: string]: any }) {\n\t\tthis.messages = messages;\n\t\tthis.checkLocale(locale);\n\t\tthis.locale = locale;\n\t},\n\n\t/**\n\t * Get the localized version of a string\n\t * @param name the name of the message\n\t * @param vars optional variables to be passed to the string\n\t * @returns string\n\t */\n\tt(name: string, vars?: {[name: string]: any}) {\n\t\tlet message: string = name\n\t\t\t.split('.')\n\t\t\t.reduce((o, i) => o[i], this.messages[this.locale]);\n\t\tfor (const key in vars) {\n\t\t\tif (Object.prototype.hasOwnProperty.call(vars, key)) {\n\t\t\t\t//@ts-ignore\n\t\t\t\tconst val: string = vars[key];\n\t\t\t\tlet regexp = new RegExp('{s*(' + key + ')s*}', 'g');\n\t\t\t\tmessage = message.replaceAll(regexp, val);\n\t\t\t}\n\t\t}\n\t\treturn message;\n\t},\n\n\t/**\n\t * Check if a locale exists in the message list\n\t * If it don't throw an Error. Does nothing otherwise.\n\t * @param locale locale to check\n\t */\n\tcheckLocale(locale: string) {\n\t\tif (!Object.keys(this.messages).includes(locale)) {\n\t\t\tthrow new Error(\n\t\t\t\t`Alpine I18n: The locale ${locale} does not exist.`,\n\t\t\t);\n\t\t}\n\t},\n\n\t/**\n\t * Save an element to update it when locale change\n\t * @param el The element that uses the magic helper\n\t */\n\tsubscribe(el: HTMLElement) {\n\t\tif (!this.subscribers.includes(<never>el)) {\n\t\t\tthis.subscribers.push(<never>el);\n\t\t}\n\t},\n\n\t/**\n\t * Update components that use the magic helpers\n\t * taken from Spruce\n\t */\n\tupdateSubscribers() {\n\t\tthis.subscribers.forEach((el: any) => {\n\t\t\tel.__x?.updateElements(el);\n\t\t});\n\t},\n};\n\nconst alpine =\n\twindow.deferLoadingAlpine || ((callback: Function) => callback());\n\nwindow.AlpineI18n = AlpineI18n;\n\nwindow.deferLoadingAlpine = function (callback: Function) {\n\twindow.AlpineI18n.start();\n\talpine(callback);\n};\n\ndeclare global {\n\tinterface Window {\n\t\tAlpine: Alpine;\n\t\tdeferLoadingAlpine: any;\n\t\tAlpineI18n: typeof AlpineI18n;\n\t}\n}\n\nexport default AlpineI18n;\n"],"names":["AlpineI18n","version","locale","name","this","currentLocale","window","dispatchEvent","localChange","updateSubscribers","messages","subscribers","Event","start","Alpine","addMagicProperty","$el","subscribe","checkLocale","vars","t","create","message","split","reduce","o","i","key","Object","prototype","hasOwnProperty","call","val","regexp","RegExp","replaceAll","keys","includes","Error","el","push","forEach","__x","updateElements","alpine","deferLoadingAlpine","callback"],"mappings":"AAEA,MAAMA,EAAa,CAClBC,QAAS,QAKTC,WAAWC,GAEVC,KAAKC,cAAgBF,EACrBG,OAAOC,cAAcH,KAAKI,aAC1BJ,KAAKK,qBAMNP,aACC,YAAYG,eAGbA,cAAe,GAMfK,SAAe,GAKfC,YAAa,GAObH,YAAa,IAAII,MAAM,iBAEvBC,QAMCP,OAAOQ,OAAOC,iBAAiB,SAAWC,IACzCZ,KAAKa,UAAUD,GACPd,IACP,IAAKA,EAAQ,YAAYA,OACzBE,KAAKc,YAAYhB,GACjBE,KAAKF,OAASA,KAShBI,OAAOQ,OAAOC,iBAAiB,IAAMC,IACpCZ,KAAKa,UAAUD,GACR,CAACb,EAAcgB,SACTC,EAAEjB,EAAMgB,MAUvBE,OAAOnB,EAAgBQ,GACtBN,KAAKM,SAAWA,EAChBN,KAAKc,YAAYhB,GACjBE,KAAKF,OAASA,GASfkB,EAAEjB,EAAcgB,GACf,IAAIG,EAAkBnB,EACpBoB,MAAM,KACNC,OAAO,CAACC,EAAGC,IAAMD,EAAEC,GAAItB,KAAKM,SAASN,KAAKF,SAC5C,IAAK,MAAMyB,KAAOR,EACjB,GAAIS,OAAOC,UAAUC,eAAeC,KAAKZ,EAAMQ,GAAM,CAEpD,MAAMK,EAAcb,EAAKQ,GACzB,IAAIM,EAAS,IAAIC,OAAO,OAASP,EAAM,OAAQ,KAC/CL,EAAUA,EAAQa,WAAWF,EAAQD,GAGvC,OAAOV,GAQRJ,YAAYhB,GACX,IAAK0B,OAAOQ,KAAKhC,KAAKM,UAAU2B,SAASnC,GACxC,UAAUoC,iCACkBpC,sBAS9Be,UAAUsB,GACJnC,KAAKO,YAAY0B,SAAgBE,IACrCnC,KAAKO,YAAY6B,KAAYD,IAQ/B9B,oBACCL,KAAKO,YAAY8B,QAASF,mBACzBA,EAAGG,QAAKC,eAAeJ,OAKpBK,EACLtC,OAAOuC,qBAAwBC,GAAuBA,KAEvDxC,OAAON,WAAaA,EAEpBM,OAAOuC,mBAAqB,SAAUC,GACrCxC,OAAON,WAAWa,QAClB+B,EAAOE"}